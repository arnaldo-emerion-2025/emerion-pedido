unit PsqEs2;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  StdCtrls, Grids, Wwdbigrd, Wwdbgrid, hGrid, ExtCtrls, Db, Wwdatsrc,
  DBTables, Wwquery, AlignEdit, DBCtrls, Mask, hEdits, jpeg, dxCntner,
  dxEditor, dxEdLib, dxDBELib, dxExEdtr, FShowpadrao, IniFiles,
  dxDBColorCurrencyEdit, dxDBColorDateEdit, dxDBColorEdit, DBGrids;

type
  TfmPsqEs2 = class(TfmShowPadrao)
    EstPro: TwwQuery;
    DsPro: TwwDataSource;
    DsIte: TwwDataSource;
    EstIte: TwwQuery;
    EstIteCODEMP: TIntegerField;
    EstIteQTMITE: TFloatField;
    EstIteQTDITE: TFloatField;
    EstIteQTRITE: TFloatField;
    EstIteCODPRO: TStringField;
    EstIteCODCLP: TStringField;
    EstIteCODGRU: TStringField;
    EstIteCODSUB: TStringField;
    EstIteVB1ITE: TFloatField;
    EstIteVB2ITE: TFloatField;
    EstIteVB3ITE: TFloatField;
    EstIteVB4ITE: TFloatField;
    EstIteVB5ITE: TFloatField;
    EstIteQTAITE: TFloatField;
    quSql: TwwQuery;
    EstProCODCLP: TStringField;
    EstProCODGRU: TStringField;
    EstProCODSUB: TStringField;
    EstProCODPRO: TStringField;
    EstProDSCPRO: TStringField;
    EstProREFPRO: TStringField;
    EstProLOCPRO: TStringField;
    EstProCODUNE: TStringField;
    EstProCODUNS: TStringField;
    EstProQTEPRO: TFloatField;
    EstProQTSPRO: TFloatField;
    EstProSAIIPI: TFloatField;
    EstProSAIICM: TFloatField;
    EstProCODST1: TStringField;
    EstProCODST2: TStringField;
    EstProQTDEMB: TFloatField;
    Label1: TLabel;
    Label30: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label32: TLabel;
    Label9: TLabel;
    Label18: TLabel;
    Label5: TLabel;
    Label13: TLabel;
    Label31: TLabel;
    Label16: TLabel;
    Label19: TLabel;
    LbVb4Ite: TLabel;
    LbVb3Ite: TLabel;
    LbVb2Ite: TLabel;
    LbVb1Ite: TLabel;
    dxDBEdit1: TdxDBColorEdit;
    EdNomClp: TEdit;
    dxDBEdit2: TdxDBColorEdit;
    dxDBEdit3: TdxDBColorEdit;
    dxDBEdit4: TdxDBColorEdit;
    dxDBEdit5: TdxDBColorEdit;
    dxDBEdit6: TdxDBColorEdit;
    dxDBEdit7: TdxDBColorEdit;
    EdNomGru: TEdit;
    EdNomSub: TEdit;
    dxDBEdit10: TdxDBColorEdit;
    EdCodUns: TEdit;
    dxDBEdit19: TdxDBColorEdit;
    EdQtdEmb: TAlignEdit;
    nvPro: TDBNavigator;
    Label29: TLabel;
    EstProIMGPRO: TBlobField;
    EstIteAPEEMP: TStringField;
    EstProSIMPRO: TStringField;
    EstProCBAPRO: TStringField;
    Label23: TLabel;
    EstProWEBPRO: TStringField;
    lbWebPro: TLabel;
    EstProCODCAT: TIntegerField;
    EstProCODTIP: TIntegerField;
    EstProCODMRC: TIntegerField;
    Label24: TLabel;
    dxDBEdit30: TdxDBColorEdit;
    EdNomCat: TEdit;
    Label25: TLabel;
    dxDBEdit31: TdxDBColorEdit;
    EdNomTip: TEdit;
    Label26: TLabel;
    dxDBEdit32: TdxDBColorEdit;
    EdNomMrc: TEdit;
    EstProFLGPRO: TStringField;
    EstProCLFSAI: TStringField;
    Label27: TLabel;
    EdClfSai: TEdit;
    dxDBEdit33: TdxDBColorEdit;
    pnSimPro: TPanel;
    EstProNUMPRO: TStringField;
    EstIteVCRITE: TFloatField;
    dbMk4Ite: TdxDBColorEdit;
    EdMk4Ite: TAlignEdit;
    dbMk3Ite: TdxDBColorEdit;
    EdMk3Ite: TAlignEdit;
    dbMk2Ite: TdxDBColorEdit;
    EdMk2Ite: TAlignEdit;
    dbMk1Ite: TdxDBColorEdit;
    EdMk1Ite: TAlignEdit;
    EstIteDS1ITE: TFloatField;
    EstIteDS2ITE: TFloatField;
    EstIteDS3ITE: TFloatField;
    EstIteDS4ITE: TFloatField;
    EstIteDS5ITE: TFloatField;
    EstProCODANT: TStringField;
    Label10: TLabel;
    Label4: TLabel;
    Label6: TLabel;
    Label8: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    Label14: TLabel;
    Label38: TLabel;
    Label41: TLabel;
    Label43: TLabel;
    Label44: TLabel;
    dxDBEdit8: TdxDBColorEdit;
    Label7: TLabel;
    dxDBEdit9: TdxDBColorEdit;
    Label22: TLabel;
    Label39: TLabel;
    EstIteQTDRMA: TFloatField;
    EstIteQTDCMP: TFloatField;
    EstIteDULCMP: TDateTimeField;
    EstIteVPFITE: TFloatField;
    EstIteMK1ITE: TFloatField;
    EstIteMK2ITE: TFloatField;
    EstIteMK3ITE: TFloatField;
    EstIteMK4ITE: TFloatField;
    EstIteMK5ITE: TFloatField;
    EstProENTIPI: TFloatField;
    EstProCLFENT: TStringField;
    EstProENTICM: TFloatField;
    EstIteVMEITE: TFloatField;
    EstIteATUQTE: TFloatField;
    Label33: TLabel;
    dxDBEdit12: TdxDBColorEdit;
    EdIdePro: TEdit;
    EstProIDEPRO: TStringField;
    EstIteVPFOUT: TFloatField;
    EstPar: TwwQuery;
    EstParFLGTAB: TStringField;
    EstIteCSTITE: TFloatField;
    EstIteVCHITE: TFloatField;
    EstIteVREITE: TFloatField;
    EstIteVCPITE: TFloatField;
    EstIteVPRITE: TFloatField;
    EdCodGru: TPanel;
    EdCodSub: TPanel;
    EdCodPro: TPanel;
    EdDscPro: TPanel;
    EdRefPro: TPanel;
    EdNumPro: TPanel;
    pnHelp: TPanel;
    Label21: TLabel;
    Label49: TLabel;
    Label50: TLabel;
    Label51: TLabel;
    Label52: TLabel;
    Label53: TLabel;
    Label54: TLabel;
    Label55: TLabel;
    Label56: TLabel;
    Label57: TLabel;
    Label58: TLabel;
    Label60: TLabel;
    Label61: TLabel;
    Label62: TLabel;
    Label63: TLabel;
    Label64: TLabel;
    Label65: TLabel;
    Label66: TLabel;
    Label67: TLabel;
    Label68: TLabel;
    Label69: TLabel;
    Label70: TLabel;
    Label71: TLabel;
    Label73: TLabel;
    Label74: TLabel;
    Label45: TLabel;
    Label46: TLabel;
    Panel3: TPanel;
    Label28: TLabel;
    Label47: TLabel;
    Label48: TLabel;
    EstIteCSTOUT: TFloatField;
    EstIteDULIMP: TDateTimeField;
    EstIteQTDIMP: TFloatField;
    Label59: TLabel;
    dbDs4Ite: TdxDBColorEdit;
    EdDs4Ite: TAlignEdit;
    dbDs3Ite: TdxDBColorEdit;
    EdDs3Ite: TAlignEdit;
    dbDs2Ite: TdxDBColorEdit;
    EdDs2Ite: TAlignEdit;
    dbDs1Ite: TdxDBColorEdit;
    EdDs1Ite: TAlignEdit;
    Label72: TLabel;
    Label77: TLabel;
    Label79: TLabel;
    Label81: TLabel;
    dbMk5Ite: TdxDBColorEdit;
    EdMk5Ite: TAlignEdit;
    dbDs5Ite: TdxDBColorEdit;
    EdDs5Ite: TAlignEdit;
    Label15: TLabel;
    dxDBEdit27: TdxDBColorEdit;
    Panel1: TPanel;
    Label34: TLabel;
    Label35: TLabel;
    Label36: TLabel;
    Label37: TLabel;
    Label40: TLabel;
    Label82: TLabel;
    Label83: TLabel;
    dxDBEdit28: TdxDBColorEdit;
    grPro: ThGrid;
    dxDBColorEdit2: TdxDBColorEdit;
    EdSaiIpi: TAlignEdit;
    Label85: TLabel;
    pnlCustosCompletos: TPanel;
    lbVcrIte: TLabel;
    lbVpfIte: TLabel;
    Label76: TLabel;
    EdDulCmp: TEdit;
    lbQtdCmp: TLabel;
    lbCstOut: TLabel;
    lbVpfOut: TLabel;
    lbDulImp: TLabel;
    EdDulImp: TEdit;
    lbQtdImp: TLabel;
    dbDulCmp: TdxDBColorDateEdit;
    dxDBDateEdit1: TdxDBColorDateEdit;
    dxDBColorEdit1: TdxDBColorEdit;
    dxDBColorEdit3: TdxDBColorEdit;
    dxDBColorEdit4: TdxDBColorEdit;
    dxDBColorEdit5: TdxDBColorEdit;
    dxDBColorEdit6: TdxDBColorEdit;
    dxDBColorEdit7: TdxDBColorEdit;
    dxDBColorEdit8: TdxDBColorEdit;
    dxDBColorEdit9: TdxDBColorEdit;
    dxDBColorEdit10: TdxDBColorEdit;
    dxDBColorEdit11: TdxDBColorEdit;
    dxDBColorEdit12: TdxDBColorEdit;
    dxDBColorEdit13: TdxDBColorEdit;
    dxDBColorEdit14: TdxDBColorEdit;
    dxDBColorEdit15: TdxDBColorEdit;
    dxDBColorEdit16: TdxDBColorEdit;
    dxDBColorEdit17: TdxDBColorEdit;
    dxDBColorEdit18: TdxDBColorEdit;
    pnlCustosSimples: TPanel;
    Label78: TLabel;
    Label87: TLabel;
    dxDBColorDateEdit1: TdxDBColorDateEdit;
    dxDBColorDateEdit2: TdxDBColorDateEdit;
    Edit1: TEdit;
    Edit2: TEdit;
    dsMonitor: TwwDataSource;
    monitor: TwwQuery;
    monitorCODFILIAL: TIntegerField;
    monitorADIQUIRIDO: TFloatField;
    monitorMINIMO: TFloatField;
    monitorMAXIMO: TFloatField;
    monitorATUAL: TFloatField;
    monitorRESERVADO: TFloatField;
    monitorRMA: TFloatField;
    monitorDISPONIVEL: TFloatField;
    grFiliais: TDBGrid;
    Label20: TLabel;
    Label42: TLabel;
    Label17: TLabel;
    Label75: TLabel;
    procedure FormCreate(Sender: TObject);
    procedure DsProDataChange(Sender: TObject; Field: TField);
    procedure FormKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure lbWebProDblClick(Sender: TObject);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
    procedure DsIteDataChange(Sender: TObject; Field: TField);
    procedure EstIteAfterOpen(DataSet: TDataSet);
    procedure FormShow(Sender: TObject);
    procedure EstProAfterScroll(DataSet: TDataSet);
  private
    {Private declarations}
    procedure AtualizaCampos;
  public
    {Public declarations}
    Ordem: Integer;
    ExiCst: string;
    CliTab: string;
    sCodClp, sCodGru, sCodSub, sCodSt1, sCodPro: string;
    iCodClp, iCodGru, iCodSub, iCodPro: string;
    sBase, sEntr, CodClp, CodGru, CodSub, CodPro, CbaPro: string;
    pCodClp, pCodGru, pCodSub, pCodPro, pCodCat, pCodSt1, pCodTip, pCodMrc: string;
    CodCli: string;
  end;

var
  rCodClp: string;
  rCodGru: string;
  rCodSub: string;
  rCodSt1: string;
  rCodCat: integer;
  rCodTip: integer;
  rCodMrc: integer;
  fmPsqEs2: TfmPsqEs2;

implementation

uses ShellAPI, dxDemoUtils, Bbgeral, Bbfuncao, BbMensag, ManGDB, PsqSim, AuxPsq,
  PsqImg, PsqObs, PsqGrd, AuxIni, PsqCde, PsqCmp, PsqRes, PsqPco, PsqBar,
  Fpadrao, PsqEs3, PsqQtdUnificado;

{$R *.DFM}

procedure TfmPsqEs2.FormCreate(Sender: TObject);
var
  QtdReg: Integer;
begin
  inherited;

  fmPadrao.modificaMascara(Self, 3, 'pedpar');

  sBase := ' Select EstPro.CodClp,' +
    ' EstPro.CodGru,' +
    ' EstPro.CodSub,' +
    ' EstPro.CodPro,' +
    ' EstPro.DscPro,' +
    ' EstPro.RefPro,' +
    ' EstPro.LocPro,' +
    ' EstPro.CodUne,' +
    ' EstPro.CodUns,' +
    ' EstPro.QtePro,' +
    ' EstPro.QtsPro,' +
    ' EstPro.EntIpi,' +
    ' EstPro.SaiIpi,' +
    ' EstPro.ClfSai,' +
    ' EstPro.ClfEnt,' +
    ' EstPro.EntIcm,' +
    ' EstPro.SaiIcm,' +
    ' EstPro.SimPro,' +
    ' EstPro.CodSt1,' +
    ' EstPro.CodSt2,' +
    ' EstPro.QtdEmb,' +
    ' EstPro.ImgPro,' +
    ' EstPro.CbaPro,' +
    ' EstPro.WebPro,' +
    ' EstPro.CodCat,' +
    ' EstPro.CodTip,' +
    ' EstPro.CodMrc,' +
    ' EstPro.FlgPro,' +
    ' EstPro.NumPro,' +
    ' EstPro.CodAnt,' +
    ' EstPro.CodNcm,' +
    ' EstPro.IdePro From EstPro';

  Ordem := 1;

  with quSQL, SQL do
  begin

    close;
    Text := ' Select Count(*) as QtdReg From GerEmp';
    Open;

    QtdReg := FieldbyName('QtdReg').AsInteger;

  end;

  if GFlgAce <> 'Sim' then
  begin

    with quSQL, SQL do
    begin

      Close;
      Text := ' Select FLGDEL,SEQIMP from GerPar';
      Open;

      if Trim(FieldbyName('FLGDEL').AsString) = '*' then
      begin

        GFlgAce := 'Sim';

        if FieldbyName('SEQIMP').AsInteger > 0 then
          GEmpLog := FieldbyName('SEQIMP').AsInteger;

      end
      else
      begin

        GEmpLog := 0;
        GFlgAce := 'Nao';

      end;
    end;
  end;

  if (QtdReg = 1) or (GFlgAce = 'Sim') then
  begin

    with EstIte, SQL do
    begin

      Close;

      Text := ' Select ite.CodEmp,' +
        ' GerEmp.ApeEmp,' +
        ' ite.CodClp,' +
        ' ite.CodGru,' +
        ' ite.CodSub,' +
        ' ite.CodPro,' +
        ' qte.QtdQte QtdIte,' +
        ' qte.QtmQte QtmIte,' +
        ' (SELECT QTD_RESERVADA FROM RESERVAS(QTE.CODEMP,QTE.CODCLP,QTE.CODGRU,QTE.CODSUB,QTE.CODPRO)) QtrIte,' +
        ' ite.Ds1Ite,' +
        ' ite.Ds2Ite,' +
        ' ite.Ds3Ite,' +
        ' ite.Ds4Ite,' +
        ' ite.Ds5Ite,' +
        ' ite.Vb1Ite,' +
        ' ite.Vb2Ite,' +
        ' ite.Vb3Ite,' +
        ' ite.Vb4Ite,' +
        ' ite.Vb5Ite,' +
        ' ite.Mk1Ite,' +
        ' ite.Mk2Ite,' +
        ' ite.Mk3Ite,' +
        ' ite.Mk4Ite,' +
        ' ite.Mk5Ite,' +
        ' ite.CstIte,' +
        ' ite.VchIte,' +
        ' ite.VreIte,' +
        ' ite.VcpIte,' +
        ' ite.VprIte,' +
        ' ite.VcrIte,' +
        ' ite.VpfOut,' +
        ' ite.CstOut,' +
        ' ite.QtdCmp,' +
        ' ite.DulCmp,' +
        ' ite.DulImp,' +
        ' ite.QtdImp,' +
        ' ite.VpfIte,' +
        ' ite.VmeIte,' +
        ' ite.QtaIte,' +
        ' ite.QtdRma, ' +
        ' Round(qte.QtdQte - ((SELECT QTD_RESERVADA FROM RESERVAS(QTE.CODEMP,QTE.CODCLP,QTE.CODGRU,QTE.CODSUB,QTE.CODPRO)) + qte.QtdRma),4) as AtuQte ' +
        ' From EstIte ' +
        ' join estqte qte on qte.codemp = ite.codemp ' +
        ' and qte.codclp = ite.codclp ' +
        ' and qte.codgru = ite.codgru ' +
        ' and qte.codsub = ite.codsub ' +
        ' and qte.codpro = ite.codpro ' +
        ' LEFT JOIN GerEmp ON (ite.CodEmp = GerEmp.CodEmp)' +
        ' Where ite.CodClp = :CodClp' +
        '   and ite.CodGru = :CodGru' +
        '   and ite.CodSub = :CodSub' +
        '   and ite.CodPro = :CodPro';

      if GFlgAce = 'Sim' then
      begin

        if GEmpLog > 0 then
          Text := Text + ' and ite.CodEmp = ' + QuotedStr(IntToStr(GEmpLog))
        else
          Text := Text + ' and GerEmp.CodFil > 0';

      end;

      Text := Text + ' Order by ite.CodEmp';

      Open;

    end;
  end;

  if (GFlgGer = 'Sim') then
  begin
    EdMk1Ite.Visible := True;
    EdMk2Ite.Visible := True;
    EdMk3Ite.Visible := True;
    EdMk4Ite.Visible := True;
    EdMk5Ite.Visible := True;
  end
  else
  begin
    EdMk1Ite.Visible := False;
    EdMk2Ite.Visible := False;
    EdMk3Ite.Visible := False;
    EdMk4Ite.Visible := False;
    EdMk5Ite.Visible := False;
  end;

  EstPar.Active := False;
  EstPar.Active := True;

end;

procedure TfmPsqEs2.DsProDataChange(Sender: TObject; Field: TField);
begin

  EdCodGru.Caption := EstProCodGru.Value;
  EdCodSub.Caption := EstProCodSub.Value;
  EdCodPro.Caption := EstProCodPro.Value;

  EdDscPro.Caption := ' ' + EstProDscPro.Value;
  EdRefPro.Caption := ' ' + EstProRefPro.Value;
  EdNumPro.Caption := ' ' + EstProNumPro.Value;

  EdIdePro.Text := ' ' + EstProIdePro.Value;
  EdCodUns.Text := ' ' + EstProCodUne.Value;
  EdClfSai.Text := ' ' + EstProCodNcm.Value;

  EdSaiIpi.Text := FormatFloat('###,###,##0.00', EstProSaiIpi.Value);

  if rCodClp <> EstProCodClp.Value then
  begin

    rCodClp := EstProCodClp.Value;

    with quSQL, SQL do
    begin

      Close;
      Text := ' Select NomClp From EstClp Where EstClp.CodClp = ''' + rCodClp +
        '''';
      Open;

      EdNomClp.Text := ' ' + FieldbyName('NomClp').AsString;

    end;
  end;

  if rCodGru <> EstProCodGru.Value then
  begin

    with quSQL, SQL do
    begin

      Close;
      Text := ' Select NomGru From EstGru Where EstGru.CodGru = ''' +
        EstProCodGru.Value + '''';
      Open;

      EdNomGru.Text := ' ' + FieldbyName('NomGru').AsString;

    end;
  end;

  if (rCodGru <> EstProCodGru.Value) or (rCodSub <> EstProCodSub.Value) then
  begin

    rCodGru := EstProCodGru.Value;
    rCodSub := EstProCodSub.Value;

    with quSQL, SQL do
    begin

      Close;
      Text := ' Select NomSub From EstSub Where EstSub.CodGru = ''' + rCodGru +
        ''' and EstSub.CodSub = ''' + rCodSub + '''';
      Open;

      EdNomSub.Text := ' ' + FieldbyName('NomSub').AsString;

    end;
  end;

  lbWebPro.Caption := EstProWebPro.Value;

  EdQtdEmb.Text := FormatFloat('######', EstProQtdEmb.Value);

  if rCodCat <> EstProCodCat.Value then
  begin

    rCodCat := EstProCodCat.Value;

    if rCodCat > 0 then
    begin

      with quSQL, SQL do
      begin

        Close;
        Text := ' Select NomCat From EstCat Where EstCat.CodCat = ''' +
          IntToStr(rCodCat) + '''';
        Open;

        EdNomCat.Text := ' ' + FieldbyName('NomCat').AsString;

      end;

    end
    else
      EdNomCat.Text := ' ';

  end
  else
  begin

    if rCodCat = 0 then
      EdNomCat.Text := ' ';

  end;

  if rCodTip <> EstProCodTip.Value then
  begin

    rCodTip := EstProCodTip.Value;

    if rCodTip > 0 then
    begin

      with quSQL, SQL do
      begin

        Close;
        Text := ' Select NomTip From EstTip Where EstTip.CodTip = ''' +
          IntToStr(rCodTip) + '''';
        Open;

        EdNomTip.Text := ' ' + FieldbyName('NomTip').AsString;

      end;

    end
    else
      EdNomTip.Text := ' ';

  end
  else
  begin

    if rCodTip = 0 then
      EdNomTip.Text := ' ';

  end;

  if rCodMrc <> EstProCodMrc.Value then
  begin

    rCodMrc := EstProCodMrc.Value;

    if rCodMrc > 0 then
    begin

      with quSQL, SQL do
      begin

        Close;
        Text := ' Select NomMrc From EstMrc Where EstMrc.CodMrc = ''' +
          IntToStr(rCodMrc) + '''';
        Open;

        EdNomMrc.Text := ' ' + FieldbyName('NomMrc').AsString;

      end;

    end
    else
      EdNomMrc.Text := ' ';

  end
  else
  begin

    if rCodMrc = 0 then
      EdNomMrc.Text := ' ';

  end;

  if EstProSimPro.Value <> '' then
  begin

    if not pnSimPro.Visible then
      pnSimPro.Visible := True;

  end
  else
  begin

    if pnSimPro.Visible then
      pnSimPro.Visible := False;

  end;

  if (EstIteCodClp.Value <> EstProCodClp.Value) or (EstIteCodGru.Value <>
    EstProCodGru.Value) or
    (EstIteCodSub.Value <> EstProCodSub.Value) or (EstIteCodPro.Value <>
    EstProCodPro.Value) then
  begin

    EstIte.Close;
    EstIte.Params[0].AsString := EstProCodClp.Value;
    EstIte.Params[1].AsString := EstProCodGru.Value;
    EstIte.Params[2].AsString := EstProCodSub.Value;
    EstIte.Params[3].AsString := EstProCodPro.Value;
    EstIte.Open;

  end;
end;

procedure TfmPsqEs2.FormKeyDown(Sender: TObject; var Key: Word; Shift:
  TShiftState);
var
  BlobStream: TStream;
  JPEGImage: TJPEGImage;
  sOrdem: string;
  sItem: TIdItem;
begin
  inherited;

  if key = 27 then
  begin

    if pnHelp.Visible then

      pnHelp.Visible := False
    else
      close;

  end;

  if key = 112 then
  begin
    pnHelp.BringToFront;
    if not pnHelp.Visible then
    begin
      pnHelp.Visible := true;
      pnHelp.Top := 2;
      pnHelp.left := 10;
    end;

  end;

  if not pnHelp.Visible then
  begin

    if not (ActiveControl is ThGrid) then
    begin

      case key of
        35: nvPro.BtnClick(nbLast); {End}
        36: nvPro.BtnClick(nbFirst); {Home}
        37: nvPro.BtnClick(nbPrior); {Seta para a Esquerda}
        39: nvPro.BtnClick(nbNext); {Seta para Direita}
        38: nvPro.BtnClick(nbNext); {Seta para Cima}
        40: nvPro.BtnClick(nbPrior); {Seta para Baixo}
      end;

    end
    else
    begin

      case key of
        35: nvPro.BtnClick(nbLast); {End}
        36: nvPro.BtnClick(nbFirst); {Home}
        37: nvPro.BtnClick(nbPrior); {Seta para a Esquerda}
        39: nvPro.BtnClick(nbNext); {Seta para Direita}
      end;
    end;

    if key = 71 then
    begin {G - Grade de Itens}

      try

        fmPsqGrd := TfmPsqGrd.Create(Self);

        fmPsqGrd.EstTam.Close;
        fmPsqGrd.EstTam.Params[0].AsInteger := EstIteCodEmp.Value;
        fmPsqGrd.EstTam.Params[1].AsString := EstIteCodClp.Value;
        fmPsqGrd.EstTam.Params[2].AsString := EstIteCodGru.Value;
        fmPsqGrd.EstTam.Params[3].AsString := EstIteCodSub.Value;
        fmPsqGrd.EstTam.Params[4].AsString := EstIteCodPro.Value;
        fmPsqGrd.EstTam.Open;

        fmPsqGrd.ShowModal;

      finally

        FreeAndNil(fmPsqGrd);

      end;
    end;

    if key = 113 then
    begin {F2 - Descrição}

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmAuxIni := TfmAuxIni.Create(Self);

        fmAuxIni.CodClp := sCodClp;
        fmAuxIni.CodGru := sCodGru;
        fmAuxIni.CodSub := sCodSub;

        fmAuxIni.TipoPesq := 'IC';

        fmAuxIni.ShowModal;

        pCodClp := fmAuxIni.CodClp;
        pCodGru := fmAuxIni.CodGru;
        pCodSub := fmAuxIni.CodSub;
        pCodPro := fmAuxIni.CodPro;

      finally

        FreeAndNil(fmAuxIni);

      end;
    end;

    if key = 114 then
    begin {F3 - Referência}

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmAuxIni := TfmAuxIni.Create(Self);

        fmAuxIni.CodClp := sCodClp;
        fmAuxIni.CodGru := sCodGru;
        fmAuxIni.CodSub := sCodSub;

        fmAuxIni.TipoPesq := 'R';

        fmAuxIni.ShowModal;

        pCodClp := fmAuxIni.CodClp;
        pCodGru := fmAuxIni.CodGru;
        pCodSub := fmAuxIni.CodSub;
        pCodPro := fmAuxIni.CodPro;

      finally

        FreeAndNil(fmAuxIni);

      end;
    end;

    if key = 115 then {F4 - Inteligente/Descrição}
    begin
      pCodSt1 := '';
      pCodCat := '';
      pCodTip := '';
      pCodMrc := '';
      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmPsqCde := TfmPsqCde.Create(Self);

        fmPsqCde.sCodClp := sCodClp;
        fmPsqCde.sCodGru := sCodGru;
        fmPsqCde.sCodSub := sCodSub;
        fmPsqCde.sCodPro := sCodPro;

        fmPsqCde.ShowModal;

        pCodSt1 := fmPsqCde.sCodSt1;
        pCodCat := fmPsqCde.sCodCat;
        pCodTip := fmPsqCde.sCodTip;
        pCodMrc := fmPsqCde.sCodMrc;
        pCodClp := fmPsqCde.sCodClp;
        pCodGru := fmPsqCde.sCodGru;
        pCodSub := fmPsqCde.sCodSub;
        pCodPro := fmPsqCde.sCodPro;

      finally

        FreeAndNil(fmPsqCde);

      end;
    end;

    if key = 116 then
    begin {F5 - Inteligente/Descrição}

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmAuxPsq := TfmAuxPsq.Create(Self);

        fmAuxPsq.CodClp := sCodClp;
        fmAuxPsq.CodGru := sCodGru;
        fmAuxPsq.CodSub := sCodSub;
        fmAuxPsq.CodPro := sCodPro;

        fmAuxPsq.TipoPesq := 'IC';

        fmAuxPsq.ShowModal;

        pCodClp := fmAuxPsq.CodClp;
        pCodGru := fmAuxPsq.CodGru;
        pCodSub := fmAuxPsq.CodSub;
        pCodPro := fmAuxPsq.CodPro;

      finally

        FreeAndNil(fmAuxPsq);

      end;
    end;

    if key = 117 then
    begin {F6 - Inteligente/Referência}

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmAuxPsq := TfmAuxPsq.Create(Self);

        if Trim(sCodClp) <> '' then
          fmAuxPsq.CodClp := sCodClp;
        if Trim(sCodGru) <> '' then
          fmAuxPsq.CodGru := sCodGru;
        if Trim(sCodSub) <> '' then
          fmAuxPsq.CodSub := sCodSub;
        if Trim(sCodPro) <> '' then
          fmAuxPsq.CodPro := sCodPro;

        fmAuxPsq.TipoPesq := 'R';

        fmAuxPsq.ShowModal;

        pCodClp := fmAuxPsq.CodClp;
        pCodGru := fmAuxPsq.CodGru;
        pCodSub := fmAuxPsq.CodSub;
        pCodPro := fmAuxPsq.CodPro;

      finally

        FreeAndNil(fmAuxPsq);

      end;
    end;

    if Trim(EstProCodGru.Value) <> '' then
    begin

      if key = 118 then
      begin {F7 - Imagem}

        try

          fmPsqImg := TfmPsqImg.Create(Self);

          if EstProImgPro.BlobSize <> 0 then
          begin

            BlobStream := EstPro.CreateBlobStream(EstProImgPro, bmRead);

            JPEGImage := TJPEGImage.Create;

            try
              JPEGImage.LoadFromStream(BlobStream);
              fmPsqImg.Image2.Picture.Assign(JPEGImage);
            finally
              FreeAndNil(BlobStream);
              FreeAndNil(JPEGImage);
            end;

          end
          else
            fmPsqImg.Image2.Picture := nil;

          fmPsqImg.EstPro.Active := False;
          fmPsqImg.EstPro.Params.ParamValues['CODCLP'] := ESTPROCODCLP.AsString;
          fmPsqImg.EstPro.Params.ParamValues['CODGRU'] := ESTPROCODGRU.AsString;
          fmPsqImg.EstPro.Params.ParamValues['CODSUB'] := ESTPROCODSUB.AsString;
          fmPsqImg.EstPro.Params.ParamValues['CODPRO'] := ESTPROCODPRO.AsString;
          fmPsqImg.EstPro.Active := True;

          fmPsqImg.ShowModal;

        finally

          FreeAndNil(fmPsqImg);

        end;
      end;

      if key = 119 then
      begin {F8 - Caracteristicas}

        try

          fmPsqObs := TfmPsqObs.Create(Self);

          fmPsqObs.EstPro.Close;
          fmPsqObs.EstPro.Params[0].AsString := EstProCodClp.Value;
          fmPsqObs.EstPro.Params[1].AsString := EstProCodGru.Value;
          fmPsqObs.EstPro.Params[2].AsString := EstProCodSub.Value;
          fmPsqObs.EstPro.Params[3].AsString := EstProCodPro.Value;
          fmPsqObs.EstPro.Open;

          fmPsqObs.ShowModal;

        finally

          FreeAndNil(fmPsqObs);

        end;
      end;
    end;

    if key = 33 then
      EstPro.MoveBy(-10); {Page Up}
    if key = 34 then
      EstPro.MoveBy(10); {Page Down}

    if key = 13 then
    begin {Enter - Confirmar Item}

      CodClp := EstProCodClp.Value;
      CodGru := EstProCodGru.Value;
      CodSub := EstProCodSub.Value;
      CodPro := EstProCodPro.Value;
      CbaPro := EstProCbaPro.Value;

      Close;

    end;

    if key = 32 then
    begin {ESPAÇO - Mudar Ordem}

      if Ordem < 4 then
        Ordem := Ordem + 1
      else
        Ordem := 1;

      if Ordem = 1 then
        Label29.Caption := '[Descrição]';
      if Ordem = 2 then
        Label29.Caption := '[Referência]';
      if Ordem = 3 then
        Label29.Caption := '[Part Number]';
      if Ordem = 4 then
        Label29.Caption := '[Grupo+Sub+Item]';

      if Ordem = 1 then
        sOrdem := ' Order by EstPro.DscPro';
      if Ordem = 2 then
        sOrdem := ' Order by EstPro.RefPro';
      if Ordem = 3 then
        sOrdem := ' Order by EstPro.NumPro';
      if Ordem = 4 then
        sOrdem :=
          ' Order by EstPro.CodClp,EstPro.CodGru,EstPro.CodSub,EstPro.CodPro';

      pCodClp := EstProCodClp.Value;
      pCodGru := EstProCodGru.Value;
      pCodSub := EstProCodSub.Value;
      pCodPro := EstProCodPro.Value;

      with EstPro, SQL do
      begin

        Close;
        //Text := sBase + ' Where EstPro.FlbPro = ''' + ' ' + '''';
        Text := sBase + ' Where 1 = 1';

        if Trim(iCodClp) <> '' then
          Text := Text + ' and EstPro.CodClp = ''' + iCodClp + '''';
        if Trim(iCodGru) <> '' then
          Text := Text + ' and EstPro.CodGru = ''' + iCodGru + '''';
        if Trim(iCodSub) <> '' then
          Text := Text + ' and EstPro.CodSub = ''' + iCodSub + '''';
        if Trim(iCodPro) <> '' then
          Text := Text + ' and EstPro.CodPro = ''' + iCodPro + '''';

        Text := Text + sOrdem;

        Open;

      end;

      EstPro.Locate('CodClp;CodGru;CodSub;CodPro', VarArrayOf([pCodClp, pCodGru,
        pCodSub, pCodPro]), [loPartialKey]);

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

    end;

    if (key = VK_F10) then
    begin
      //fmPsqEs3 := TfmPsqEs3.Create(Self);
      //fmpsqEs3.ShowModal;
      frmPsqQtdUnificado := TfrmPsqQtdUnificado.Create(Self);
      try
         sItem.CODCLP := EstProCodClp.AsString;
         sItem.CODGRU := EstProCodGru.AsString;
         sItem.CODSUB := EstProCodSub.AsString;
         sItem.CODPRO := EstProCodPro.AsString;
         sItem.Descricao := EstProDSCPRO.AsString;

         frmPsqQtdUnificado.Showmodal(sItem);
      finally
          FreeAndnil(frmPsqQtdUnificado);
      end;
      
    end;                            

    if key = 83 then
    begin {S - Verificar Similares}

      if Trim(EstProSimPro.Value) <> '' then
      begin

        pCodClp := '';
        pCodGru := '';
        pCodSub := '';
        pCodPro := '';

        try

          fmPsqSim := TfmPsqSim.Create(Self);

          with fmPsqSim.EstPro, SQL do
          begin

            Close;
            //Text := sBase + ' Where EstPro.FlbPro = ''' + ' ' + '''';
            Text := sBase + ' Where 1 = 1';

            if Trim(sCodClp) <> '' then
              Text := Text + ' and EstPro.CodClp = ''' + sCodClp +
                ''' and EstPro.SimPro = ''' + EstProSimPro.Value + ''''
            else
              Text := Text + ' and EstPro.SimPro = ''' + EstProSimPro.Value +
                '''';

            Text := Text +
              ' Order by EstPro.CodClp,EstPro.CodGru,EstPro.CodSub,EstPro.CodPro';

            Open;

          end;

          fmPsqSim.ShowModal;

          pCodClp := fmPsqSim.CodClp;
          pCodGru := fmPsqSim.CodGru;
          pCodSub := fmPsqSim.CodSub;
          pCodPro := fmPsqSim.CodPro;

        finally

          FreeAndNil(fmPsqSim);

        end;
      end;
    end;

    if (Trim(pCodSt1) <> '') or //Select dos campos de pesquisa são feito aqui
    (Trim(pCodCat) <> '') or
      (Trim(pCodTip) <> '') or
      (Trim(pCodMrc) <> '') or
      (Trim(pCodGru) <> '') or
      (Trim(pCodSub) <> '') or
      (Trim(pCodPro) <> '') then
    begin

      if Ordem = 1 then
        sOrdem := ' Order by EstPro.DscPro';
      if Ordem = 2 then
        sOrdem := ' Order by EstPro.RefPro';
      if Ordem = 3 then
        sOrdem := ' Order by EstPro.NumPro';
      if Ordem = 4 then
        sOrdem :=
          ' Order by EstPro.CodClp,EstPro.CodGru,EstPro.CodSub,EstPro.CodPro';

      with EstPro, SQL do
      begin

        Close;
        Text := ' Select EstPro.CodClp,' +
          ' EstPro.CodGru,' +
          ' EstPro.CodSub,' +
          ' EstPro.CodPro,' +
          ' EstPro.DscPro,' +
          ' EstPro.RefPro,' +
          ' EstPro.LocPro,' +
          ' EstPro.CodUne,' +
          ' EstPro.CodUns,' +
          ' EstPro.QtePro,' +
          ' EstPro.QtsPro,' +
          ' EstPro.EntIpi,' +
          ' EstPro.SaiIpi,' +
          ' EstPro.ClfSai,' +
          ' EstPro.ClfEnt,' +
          ' EstPro.EntIcm,' +
          ' EstPro.SaiIcm,' +
          ' EstPro.SimPro,' +
          ' EstPro.CodSt1,' +
          ' EstPro.CodSt2,' +
          ' EstPro.QtdEmb,' +
          ' EstPro.ImgPro,' +
          ' EstPro.CbaPro,' +
          ' EstPro.WebPro,' +
          ' EstPro.CodCat,' +
          ' EstPro.CodTip,' +
          ' EstPro.CodMrc,' +
          ' EstPro.FlgPro,' +
          ' EstPro.NumPro,' +
          ' EstPro.CodAnt,' +
          ' EstPro.CodNcm,' +
          ' EstPro.IdePro' +
          ' From EstPro' +
          ' Where EstPro.CodClp = ''' + '1' + '''' +
          //'   and EstPro.FlbPro = ''' + ' ' + '''';
          '   and 1 = 1 ';

        if Trim(pCodSt1) <> '' then
          Text := Text + ' and EstPro.CodSt1 = ''' + pCodSt1 + '''';
        if Trim(pCodCat) <> '' then
          Text := Text + ' and EstPro.CodCat = ''' + pCodCat + '''';
        if Trim(pCodTip) <> '' then
          Text := Text + ' and EstPro.CodTip = ''' + pCodTip + '''';
        if Trim(pCodMrc) <> '' then
          Text := Text + ' and EstPro.CodMrc = ''' + pCodMrc + '''';
        if Trim(pCodGru) <> '' then
          Text := Text + ' and EstPro.CodGru = ''' + pCodGru + '''';
        if Trim(pCodSub) <> '' then
          Text := Text + ' and EstPro.CodSub = ''' + pCodSub + '''';
        if Trim(pCodPro) <> '' then
          Text := Text + ' and EstPro.CodPro = ''' + pCodPro + '''';

        Text := Text + sOrdem;

        Open;

      end;

      iCodClp := pCodClp;
      iCodGru := pCodGru;
      iCodSub := pCodSub;
      iCodPro := pCodPro;

      pCodSt1 := '';
      pCodCat := '';
      pCodTip := '';
      pCodMrc := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

    end;
  end;
end;

procedure TfmPsqEs2.lbWebProDblClick(Sender: TObject);
var
  pagina: string;
begin
  inherited;

  pagina := 'http://' + LbWebPro.Caption;

  ShellExecute(0, nil, PChar(pagina), nil, nil, sw_Normal);

end;

procedure TfmPsqEs2.FormKeyPress(Sender: TObject; var Key: Char);
var
  sOrdem: string;
begin
  inherited;

  if not pnHelp.Visible then
  begin

    if key = #2 then
    begin

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmPsqBar := TfmPsqBar.Create(Self);

        fmPsqBar.ShowModal;

        pCodClp := fmPsqBar.sCodClp;
        pCodGru := fmPsqBar.sCodGru;
        pCodSub := fmPsqBar.sCodSub;
        pCodPro := fmPsqBar.sCodPro;

      finally

        FreeAndNil(fmPsqBar);

      end;
    end;

    if key = #16 then
    begin

      pCodClp := '';
      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

      try

        fmAuxIni := TfmAuxIni.Create(Self);

        fmAuxIni.CodClp := sCodClp;
        fmAuxIni.CodGru := sCodGru;
        fmAuxIni.CodSub := sCodSub;

        fmAuxIni.TipoPesq := 'U';

        fmAuxIni.ShowModal;

        pCodClp := fmAuxIni.CodClp;
        pCodGru := fmAuxIni.CodGru;
        pCodSub := fmAuxIni.CodSub;
        pCodPro := fmAuxIni.CodPro;

      finally

        FreeAndNil(fmAuxIni);

      end;
    end;

    if (Trim(pCodGru) <> '') or
      (Trim(pCodSub) <> '') or
      (Trim(pCodPro) <> '') then
    begin

      if Ordem = 1 then
        sOrdem := ' Order by EstPro.DscPro';
      if Ordem = 2 then
        sOrdem := ' Order by EstPro.RefPro';
      if Ordem = 3 then
        sOrdem := ' Order by EstPro.NumPro';
      if Ordem = 4 then
        sOrdem :=
          ' Order by EstPro.CodClp,EstPro.CodGru,EstPro.CodSub,EstPro.CodPro';

      with EstPro, SQL do
      begin

        Close;
        Text := ' Select EstPro.CodClp,' +
          ' EstPro.CodGru,' +
          ' EstPro.CodSub,' +
          ' EstPro.CodPro,' +
          ' EstPro.DscPro,' +
          ' EstPro.RefPro,' +
          ' EstPro.LocPro,' +
          ' EstPro.CodUne,' +
          ' EstPro.CodUns,' +
          ' EstPro.QtePro,' +
          ' EstPro.QtsPro,' +
          ' EstPro.EntIpi,' +
          ' EstPro.SaiIpi,' +
          ' EstPro.ClfSai,' +
          ' EstPro.ClfEnt,' +
          ' EstPro.EntIcm,' +
          ' EstPro.SaiIcm,' +
          ' EstPro.SimPro,' +
          ' EstPro.CodSt1,' +
          ' EstPro.CodSt2,' +
          ' EstPro.QtdEmb,' +
          ' EstPro.ImgPro,' +
          ' EstPro.CbaPro,' +
          ' EstPro.WebPro,' +
          ' EstPro.CodCat,' +
          ' EstPro.CodTip,' +
          ' EstPro.CodMrc,' +
          ' EstPro.FlgPro,' +
          ' EstPro.NumPro,' +
          ' EstPro.CodAnt,' +
          ' EstPro.CodNcm,' +
          ' EstPro.IdePro' +
          ' From EstPro' +
          ' Where EstPro.CodClp = ''' + '1' + '''' +
          //'   and EstPro.FlbPro = ''' + ' ' + '''';
          '   and 1 = 1 ';

        if Trim(pCodGru) <> '' then
          Text := Text + ' and EstPro.CodGru = ''' + pCodGru + '''';
        if Trim(pCodSub) <> '' then
          Text := Text + ' and EstPro.CodSub = ''' + pCodSub + '''';
        if Trim(pCodPro) <> '' then
          Text := Text + ' and EstPro.CodPro = ''' + pCodPro + '''';

        Text := Text + sOrdem;

        Open;

      end;

      iCodClp := pCodClp;
      iCodGru := pCodGru;
      iCodSub := pCodSub;
      iCodPro := pCodPro;

      pCodGru := '';
      pCodSub := '';
      pCodPro := '';

    end;

    if Trim(EstProCodGru.Value) <> '' then
    begin

      if key = #18 then
      begin // Reservas //

        try

          fmPsqRes := TfmPsqRes.Create(Self);

          fmPsqRes.Panel3.Caption := ' ' + EstProCodGru.Value + '.' +
            EstProCodSub.Value + '.' + EstProCodPro.Value + ' - ' +
            EstProDscPro.Value;

          fmPsqRes.PedRes.Close;
          fmPsqRes.PedRes.Params[0].AsString := EstProCodClp.Value;
          fmPsqRes.PedRes.Params[1].AsString := EstProCodGru.Value;
          fmPsqRes.PedRes.Params[2].AsString := EstProCodSub.Value;
          fmPsqRes.PedRes.Params[3].AsString := EstProCodPro.Value;
          fmPsqRes.PedRes.Open;

          fmPsqRes.ShowModal;

        finally

          FreeAndNil(fmPsqRes);

        end;
      end;

      if key = #3 then
      begin // Comprado //

        try

          fmPsqCmp := TfmPsqCmp.Create(Self);

          fmPsqCmp.Panel3.Caption := ' ' + EstProCodGru.Value + '.' +
            EstProCodSub.Value + '.' + EstProCodPro.Value + ' - ' +
            EstProDscPro.Value;

          fmPsqCmp.CmpPed.Close;
          fmPsqCmp.CmpPed.Params[0].AsString := EstProCodClp.Value;
          fmPsqCmp.CmpPed.Params[1].AsString := EstProCodGru.Value;
          fmPsqCmp.CmpPed.Params[2].AsString := EstProCodSub.Value;
          fmPsqCmp.CmpPed.Params[3].AsString := EstProCodPro.Value;
          fmPsqCmp.CmpPed.Open;

          fmPsqCmp.ShowModal;

        finally

          FreeAndNil(fmPsqCmp);

        end;
      end;

      if key = #6 then
      begin // Preços de Fornecedores //

        try

          fmPsqPco := TfmPsqPco.Create(Self);

          fmPsqPco.Label1.Caption := EstProCodGru.Value + '.' +
            EstProCodSub.Value + '.' + EstProCodPro.Value + ' - ' +
            EstProDscPro.Value;

          fmPsqPco.CmpPfo.Close;
          fmPsqPco.CmpPfo.Params[0].AsString := EstProCodClp.Value;
          fmPsqPco.CmpPfo.Params[1].AsString := EstProCodGru.Value;
          fmPsqPco.CmpPfo.Params[2].AsString := EstProCodSub.Value;
          fmPsqPco.CmpPfo.Params[3].AsString := EstProCodPro.Value;
          fmPsqPco.CmpPfo.Open;

          fmPsqPco.ShowModal;

        finally

          FreeAndNil(fmPsqPco);

        end;
      end;
    end;
  end;
end;

procedure TfmPsqEs2.DsIteDataChange(Sender: TObject; Field: TField);
begin
  AtualizaCampos;
end;

procedure TfmPsqEs2.AtualizaCampos;
var
  VbaIte: real;
begin
  VbaIte := 0;
  if EstParFlgTab.Value = 'Ultimo Preco' then
    VbaIte := EstIteCstIte.AsFloat;
  if EstParFlgTab.Value = 'Custo Historico' then
    VbaIte := EstIteVchIte.AsFloat;
  if EstParFlgTab.Value = 'Custo Ponderado' then
    VbaIte := EstIteVreIte.AsFloat;
  if EstParFlgTab.Value = 'Custo Referencial' then
    VbaIte := EstIteVcrIte.AsFloat;
  if EstParFlgTab.Value = 'Ultimo Custo(CIF)' then
    VbaIte := EstIteVpfOut.AsFloat;
  if EstParFlgTab.Value = 'Custo Historico (G)' then
    VbaIte := EstIteVcpIte.AsFloat;
  if EstParFlgTab.Value = 'Custo Ponderado (G)' then
    VbaIte := EstIteVprIte.AsFloat;
  if EstParFlgTab.Value = 'Media Ponderada (E)' then
    VbaIte := EstIteVmeIte.AsFloat;
  if EstParFlgTab.Value = 'Custo da Ultima Compra' then
    VbaIte := EstIteVpfIte.AsFloat;

  EdMk1Ite.Text := FormatFloat('###,###,##0.00', EstIteMk1Ite.AsFloat);
  EdMk2Ite.Text := FormatFloat('###,###,##0.00', EstIteMk2Ite.AsFloat);
  EdMk3Ite.Text := FormatFloat('###,###,##0.00', EstIteMk3Ite.AsFloat);
  EdMk4Ite.Text := FormatFloat('###,###,##0.00', EstIteMk4Ite.AsFloat);
  EdMk5Ite.Text := FormatFloat('###,###,##0.00', EstIteMk5Ite.AsFloat);

  EdDs1Ite.Text := FormatFloat('###,###,##0.00', EstIteDs1Ite.AsFloat);
  EdDs2Ite.Text := FormatFloat('###,###,##0.00', EstIteDs2Ite.AsFloat);
  EdDs3Ite.Text := FormatFloat('###,###,##0.00', EstIteDs3Ite.AsFloat);
  EdDs4Ite.Text := FormatFloat('###,###,##0.00', EstIteDs4Ite.AsFloat);
  EdDs5Ite.Text := FormatFloat('###,###,##0.00', EstIteDs5Ite.AsFloat);

  EdDulImp.Visible := True;

  EdDulCmp.Text := ' ' + FormatDateTime('dd/mm/yyyy', EstIteDulCmp.AsDateTime);
  EdDulImp.Text := ' ' + FormatDateTime('dd/mm/yyyy', EstIteDulImp.AsDateTime);
  edit1.Text := EdDulCmp.Text;
  edit2.Text := EdDulImp.Text;
end;

procedure TfmPsqEs2.EstIteAfterOpen(DataSet: TDataSet);
begin
  inherited;
  AtualizaCampos;
end;

procedure TfmPsqEs2.FormShow(Sender: TObject);
var
   arq : TIniFile;
   mostraFilial : String;
begin
  inherited;
  if (GUsu_Id <> 1) and (GUsu_Id <> 999) and (GFlgGer <> 'Sim') then
    pnlCustosSimples.BringtoFront
  else
    pnlCustosCompletos.BringToFront;

  arq := TIniFile.Create('C:\Emerion\CONFIG.ini');
  mostraFilial := arq.ReadString('Comercial','MOSTRA_FILIAL','NAO');
  arq.Free;

  if(UpperCase(Trim(mostraFilial)) = 'SIM') then
     grFiliais.Visible := True
  else
     grFiliais.Visible := False;
end;

procedure TfmPsqEs2.EstProAfterScroll(DataSet: TDataSet);
begin
  inherited;

   monitor.Active := False;

   monitor.Params[0].AsString := EstProCodClp.Value;
   monitor.Params[1].AsString := EstProCodGru.Value;
   monitor.Params[2].AsString := EstProCodSub.Value;
   monitor.Params[3].AsString := EstProCodPro.Value;

   monitor.Active := True;
   
end;

end.

